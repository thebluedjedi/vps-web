#vps-web flask/guincorn
networks:
  vps:
    external: true

services:
  web:
    build: .
    container_name: vps-web
    restart: always
    networks:
      - vps
    volumes:
      - .:/app
    environment:
      - FLASK_ENV=production
    secrets:
      - telegram_bot_token
      - telegram_user_id
      - flask_secret_key
    labels:
      # Traefik routing for public site
      - "traefik.enable=true"
      - "traefik.http.routers.bluedjedi-public.rule=Host(`bluedjedi.com`)"
      - "traefik.http.routers.bluedjedi-public.entrypoints=websecure"
      - "traefik.http.routers.bluedjedi-public.tls.certresolver=cloudflare"
      
      # Admin site routing
      - "traefik.http.routers.bluedjedi-admin.rule=Host(`admin.bluedjedi.com`)"
      - "traefik.http.routers.bluedjedi-admin.entrypoints=websecure"
      - "traefik.http.routers.bluedjedi-admin.tls.certresolver=cloudflare"
      
      # Internal port
      - "traefik.http.services.bluedjedi-web.loadbalancer.server.port=5000"


secrets:
  telegram_bot_token:
    file: /opt/key/telegram_bot_token.txt
  telegram_user_id:
    file: /opt/key/telegram_user_id.txt
  flask_secret_key:
    file: /opt/key/flask_secret_key.txt
